<!DOCTYPE html>

<html>
  <head>
    <script type="text/javascript" src="http://mbostock.github.com/d3/d3.js"></script>
  </head>
  <body>
    <h1>Hello from Go!</h1>
    <div id="viz"></div>
    <script type="text/javascript">

      d3.json("/data", function(json) {
        var data = json;
        renderVis(data);
      })

      function renderVis(data) {

        var h = "400px";
        var w = "600px";

        bkmin = d3.min(data, function(d) {return d.BookCount;})
        bkmax = d3.max(data, function(d) {return d.BookCount;})

        dmin = d3.min(data, function(d) {return d.PageDensity;})
        dmax = d3.max(data, function(d) {return d.PageDensity;})

        var xscale = d3.scale.linear()
         .domain([dmin, dmax])
         .range([0, w])
        var yscale = d3.scale.linear()
         .domain([bkmin, bkmax])
         .range([h, 0])

        var viz = d3.select("#viz")
        .append("svg:svg")
        .attr("width", w)
        .attr("height", h);

        var circle = viz.selectAll("circle")
        circle.data(data)
          .enter().append("svg:circle")
          .style("stroke", "red")
          .style("fill", "black")
          .attr("r", 5)
          .attr("cx", function(d, i) {return xscale(d.PageDensity);})
          .attr("cy", function(d, i) {return yscale(d.BookCount);})
          .on("mouseover", function(){
            d3.select(this)
              .style("fill", "blue");
          })
          .on("mouseout", function(){
            d3.select(this)
              .style("fill", "black");
            })

        viz.selectAll("text")
          .data(data)
          .enter().append("text")
          //.style("stroke", "white")
          .attr("x", function(d, i) {return xscale(d.PageDensity);})
          .attr("y", function(d, i) {return yscale(d.BookCount);})
          .attr("text-anchor", "left")
          .text(function(d) {
            return d.Text + ": " + String(d.PageDensity) + ", " + String(d.BookCount);
          })
      }

    </script>
  </body>
</html>
